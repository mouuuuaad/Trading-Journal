rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /trades/{tradeId} {

      // A trade document can be read if it's either:
      // 1. Explicitly marked as shared for public viewing.
      // 2. Being accessed by its owner.
      allow read: if resource.data.shared == true || (request.auth != null && request.auth.uid == resource.data.userId);

      // A user can create a trade if they are authenticated and the new trade's
      // userId field matches their own auth uid. This prevents a user from creating
      // trades on behalf of someone else.
      allow create: if request.auth != null && request.auth.uid == request.resource.data.userId;

      // A user can update or delete a trade if they are authenticated and they are
      // the owner of the document as it currently exists in the database.
      // This prevents a user from changing the owner of a trade.
      allow update, delete: if request.auth != null && request.auth.uid == resource.data.userId;
    }
  }
}
